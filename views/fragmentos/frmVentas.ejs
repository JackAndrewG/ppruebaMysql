<script>
function cargarMarcas() {
    var url = "http://localhost:3000/ventas/recursos/marcas";
    $.ajax({
        url: url,
        type: 'GET',
        dataType: 'JSON',
        success: function (data, textStatus, jqXHR) {
            console.log(data);
            console.log(data.marcas);
            var html = "<option value=''>Seleccione una marca</option>";
            $.each(data.marcas, function (i, item) {
                html += '<option value = "' + item + '">' + item + '</option>';
            });
            $("#marca").html(html);
        },
        error: function (jqXHR, textStatus, errorThrown) {

        }
    });
}
function cargarColores() {
    $("#marca").change(function () {
        $("#colores").html("");
        var marca = $("#marca").val();
        var url = "http://localhost:3000/ventas/recursos/colores";
        $.ajax({
            url: url,
            type: 'GET',
            data: 'marcas=' + marca,
            dataType: 'JSON',
            success: function (data, textStatus, jqXHR) {
                console.log(data);
                var html = "";
                $.each(data, function (i, item) {
                    html += '<option value = "' + item + '">' + item + '</option>';
                });
                $("#colores").html(html);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log(jqXHR.responseText);
            }
        });
    });
}



    $().ready(function () {
        cargarTabla();
        cargarMarcas();
        cargarColores();
    });

    function cargarTabla() {
            var url = "http://localhost:3000/ventas/recursos/listarTodos";       ///test/sw/listaProdLot
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'JSON',
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    var html = "";
                    $.each(data, function (i, item) {
                        html += '<tr>';
                        html += '<td>'+(i+1)+'</td>';
                        html += '<td>'+item.pagoTarjeta+'</td>';
                        html += '<td>'+item.total+'</td>';
                        html += '<td>'+item.estado+'</td>';
                        html += '<td><button onclick="return verTotales('+item.id+')" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">Ver cantidad de compras</button></td>';
                        html += '</tr>';
                    });
                    $("#tabla tbody").html(html);
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(jqXHR.responseText);
                }
            });
    }
    function verTotales(id) {
        var url = "http://localhost:3000/recursos/totales/"+id;       ///test/sw/listaProdLot
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'JSON',
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    if(data.cantidad != null) {
                        $("#cantP").html(data.cantidad);
                    } else {
                        $("#cantP").html("0");
                    }

                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(jqXHR.responseText);
                }
            });
    }

</script>

<meta charset="utf-8">
<title>
  <%= titulo %>
</title>
<!--<script src="javascripts/paises.js"></script> -->
  <div class="gallery"><h1>VENTA DE PARTES PARA SU VEHICULO</h1></div>
<div class="container">
  <div class="row">
    <!-- FORM -->
    <div class="col-md-5">
      <div class="card">
        <div class="card-body">
          <form id="venta" action="/guardarVenta" method="POST">
            <input id="external" name="external" value="0" type="hidden">
            <div class="form-group">
              <select class="form-control" name="cliente" id='clientes'>
              </select>
              <small>Nombre del Cliente</small>
            </div>
            <div class="form-group">
              <input type="date" id="fecha" name="fecha" value="" class="form-control" required minlength="3">
              <small>Seleccione la fecha de venta</small>
            </div>

            <div class="form-group">
              <select class="form-control" name="marca" id='marca'>
              </select>
              <small>Seleccione la Marca del Vehiculo</small>
            </div>
            <div class="form-group">
              <select class="form-control" name="color" id="colores">
              </select>
              <small>Seleccione el color del vehiculo</small>
            </div>
            <div class="form-group">
              <input type="text" id="precio" name="precio" placeholder="precio" class="form-control" required digits >
              <small for="nombre">Costo de Parte para su vehiculo</small>
            </div>
            <div class="form-group">
              <button id="btn" type="submit" class="btn btn-primary btn-block">Vender</button>
              <small>Este botón permite registrar o modificar  la venta según sea requerido</small>
                <script>
                  $().ready(function() {
                    $("#btn").click(function() {
                      var external = $("#external").val();
                      if (external == "0") {
                        $('#venta').attr('action', '/guardarVenta');
                      } else {
                        $('#venta').attr('action', '/editarVenta');
                      }
                    });
                  });

        function calcularTotal(){
          if ($('#marca').val() == 'Chevrolet') {
            $('#precio').val('24.2');
          }
          if ($('#marca').val() == 'Nissan') {
            $('#precio').val('12.3');
          }
          if ($('#marca').val() == 'Toyota') {
            $('#precio').val('34.1');
          }
          if ($('#marca').val() == 'kia') {
            $('#precio').val('87.2');
          }
          if ($('#marca').val() == 'Mecedez Benz') {
            $('#precio').val('65.3');
          }
        }
        $('#marca').change(function(){
          calcularTotal();
        });

                </script>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!--  LIST-->
    <div class="col-md-7">
      <div style="background-color:green; color:white; font-size: 24px;">
        <%- locals.flash %>
      </div>
      <table class="table table-bordered table-hover" id="tabla">
        <thead>
          <tr>
            <th>Nro</th>
            <th>Tarjeta</th>
            <th>Pago</th>
            <th>Estado</th>
            <th>Cantidad</th>
          </tr>
        </thead>
          <tbody>

          </tbody>
      </table>
    </div>
  </div>
</div>
